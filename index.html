<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Precios y Cotizaciones</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #212529;
            --white: #fff;
            --danger-color: #dc3545;
            --danger-hover: #c82333;
            --success-color: #28a745;
            --info-color: #17a2b8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f4f9;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            background: var(--white);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1, h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        .tasas-container, .producto-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
            background-color: var(--secondary-color);
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        
        .producto-form {
             grid-template-columns: 2fr 1fr 1fr auto;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.25);
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            align-self: end;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: #004494;
        }

        .btn-info {
            background-color: var(--info-color);
            color: var(--white);
        }
        .btn-info:hover {
            background-color: #138496;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: var(--white);
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        .btn-danger:hover {
            background-color: var(--danger-hover);
        }

        .tabla-precios {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
        }

        .tabla-precios th, .tabla-precios td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        .tabla-precios thead {
            background-color: var(--primary-color);
            color: var(--white);
        }

        .tabla-precios tbody tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        
        .tabla-precios td:nth-child(n+3) {
            text-align: right;
            font-family: "Courier New", Courier, monospace;
            font-weight: bold;
        }

        .costo-original-eur {
            font-size: 0.85em;
            color: #6c757d;
        }
        
        .na {
            color: #999;
            text-align: center !important;
            font-style: italic;
        }

        .cotizacion-container {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .cotizacion-actions {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .payment-options {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .resultados-grid {
            margin-top: 20px;
        }

        .resultado-item {
            background-color: var(--white);
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }

        .resultado-item h3 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .resultado-item p {
            margin: 5px 0 0;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .resultado-item p.total-bs {
            color: var(--success-color);
        }

        #printable-receipt {
            display: none;
        }

        .calculo-precio-venta-bcv-container {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        .calculo-precio-venta-bcv-container .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) auto;
            gap: 20px;
            align-items: end;
        }

        /* --- ESTILOS PARA MÓVILES --- */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .producto-form {
                grid-template-columns: 1fr;
            }
            .calculo-precio-venta-bcv-container .form-row {
                grid-template-columns: 1fr;
            }

            .tabla-precios thead {
                display: none;
            }

            .tabla-precios, .tabla-precios tbody, .tabla-precios tr, .tabla-precios td {
                display: block;
                width: 100%;
            }

            .tabla-precios tr {
                margin-bottom: 15px;
                border: 1px solid var(--border-color);
                border-radius: 5px;
                padding: 10px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            }

            .tabla-precios td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 5px;
                border: none;
                border-bottom: 1px solid #f0f0f0;
                text-align: right !important;
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
                font-weight: normal;
            }
            
            .tabla-precios td:last-child {
                border-bottom: none;
                justify-content: center;
                padding-top: 10px;
            }

            .tabla-precios td::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--primary-color);
                text-align: left;
                margin-right: 10px;
            }
            
            .na {
                text-align: right !important;
            }
        }

        /* --- ESTILOS PARA IMPRESIÓN --- */
        @media print {
            body {
                background-color: var(--white);
                padding: 0;
                margin: 0;
            }
            .non-printable {
                display: none !important;
            }
            #printable-receipt {
                display: block;
                font-family: 'sans-serif';
                font-size: 12pt;
                color: #000;
                padding: 20mm;
            }
            #printable-receipt .logo {
                display: block;
                margin: 0 auto 25px;
                max-width: 180px;
                max-height: 100px;
            }
            #printable-receipt h1 {
                color: #000;
                text-align: center;
                font-size: 22pt;
            }
            #printable-receipt table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 25px;
            }
            #printable-receipt th, #printable-receipt td {
                border: 1px solid #888;
                padding: 10px;
                text-align: left;
            }
            #printable-receipt th {
                background-color: #eee;
            }
            #printable-receipt .total-row td {
                font-weight: bold;
                font-size: 14pt;
                border-top: 2px solid #000;
            }
            #printable-receipt .text-right {
                text-align: right;
            }
        }

    </style>
</head>
<body>

    <div class="container non-printable">
        <h1>Gestor de Precios y Cotizaciones</h1>

        <h2>Tasas de Referencia</h2>
        <div class="tasas-container">
            <div class="form-group">
                <label for="tasa-bcv">Dólar BCV (Bs.)</label>
                <input type="number" id="tasa-bcv" placeholder="Ej: 36.50" step="0.01">
            </div>
            <div class="form-group">
                <label for="tasa-binance">Dólar Binance (Bs.)</label>
                <input type="number" id="tasa-binance" placeholder="Ej: 38.20" step="0.01">
            </div>
            <div class="form-group">
                <label for="tasa-euro">Euro BCV (Bs.)</label>
                <input type="number" id="tasa-euro" placeholder="Ej: 40.15" step="0.01">
            </div>
            <div class="form-group">
                <label for="tasa-usd-eur">Tasa Dólar a Euro</label>
                <input type="number" id="tasa-usd-eur" placeholder="Ej: 0.92" step="0.001">
            </div>
        </div>

        <h2>Añadir Producto</h2>
        <div class="producto-form">
            <div class="form-group">
                <label for="producto-nombre">Nombre del Producto</label>
                <input type="text" id="producto-nombre" placeholder="Ej: Laptop Modelo X">
            </div>
            <div class="form-group">
                <label for="producto-costo">Costo</label>
                <input type="number" id="producto-costo" placeholder="Ej: 850.00" step="0.01">
            </div>
            <div class="form-group">
                <label for="producto-moneda">Moneda</label>
                <select id="producto-moneda">
                    <option value="USD">USD ($)</option>
                    <option value="EUR">EUR (€)</option>
                </select>
            </div>
            <button id="btn-agregar" class="btn btn-primary">Añadir</button>
        </div>

        <table class="tabla-precios">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Costo Original</th>
                    <th>Precio en Bs (Tasa BCV)</th>
                    <th>Precio en Bs (Tasa Binance)</th>
                    <th>Precio en Bs (Tasa Euro)</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody id="tabla-body">
                <!-- Las filas de productos se añadirán aquí -->
            </tbody>
        </table>
        
        <div class="cotizacion-container">
            <h2>Cotización</h2>
            <div class="cotizacion-actions">
                <div class="payment-options">
                    <strong>Pagar con:</strong>
                    <label><input type="radio" name="payment-method" value="USD" checked> USD/USDT</label>
                    <label><input type="radio" name="payment-method" value="VES"> Bolívares</label>
                </div>
                <button id="btn-calcular-cotizacion" class="btn btn-primary">Calcular Total</button>
                <button id="btn-imprimir" class="btn btn-info">Imprimir Recibo</button>
            </div>
            <div id="cotizacion-resultados" class="resultados-grid">
                <!-- Los resultados se mostrarán aquí -->
            </div>
        </div>
    </div>

            <div id="printable-receipt"></div>
    
            <div class="calculo-precio-venta-bcv-container non-printable">
                <h2>Calcular Precio de Venta BCV para Recompra USDT</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="costo-original-usd-recompra">Costo Original del Producto (USD)</label>
                        <input type="number" id="costo-original-usd-recompra" placeholder="Ej: 10.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="tasa-p2p-binance-recompra">Tasa P2P Binance (Bs/USD)</label>
                        <input type="number" id="tasa-p2p-binance-recompra" placeholder="Ej: 270.00" step="0.01">
                    </div>
                    <button id="btn-calcular-precio-venta-bcv" class="btn btn-primary">Calcular Precio Venta BCV</button>
                </div>
                            <div id="resultado-precio-venta-bcv" class="resultado-item" style="margin-top: 20px; display: none;">
                                <h3>Precio de Venta BCV Sugerido</h3>
                                <p id="precio-venta-bcv-sugerido"></p>
                                <p id="precio-venta-bcv-sugerido-usd" style="font-size: 1.2rem; color: #6c757d;"></p>
                            </div>            </div>
    
        <script>        document.addEventListener('DOMContentLoaded', () => {
            // --- REFERENCIAS A ELEMENTOS DEL DOM ---
            const tasaBcvInput = document.getElementById('tasa-bcv');
            const tasaBinanceInput = document.getElementById('tasa-binance');
            const tasaEuroInput = document.getElementById('tasa-euro');
            const tasaUsdEurInput = document.getElementById('tasa-usd-eur');
            
            const productoNombreInput = document.getElementById('producto-nombre');
            const productoCostoInput = document.getElementById('producto-costo');
            const productoMonedaSelect = document.getElementById('producto-moneda');
            
            const btnAgregar = document.getElementById('btn-agregar');
            const tablaBody = document.getElementById('tabla-body');

            const btnCalcularCotizacion = document.getElementById('btn-calcular-cotizacion');
            const btnImprimir = document.getElementById('btn-imprimir');
            const cotizacionResultados = document.getElementById('cotizacion-resultados');
            const printableReceipt = document.getElementById('printable-receipt');

            // --- ALMACÉN DE DATOS ---
            let productos = [];

            // --- FUNCIONES DE FORMATO ---
            const formatBs = (value) => {
                if (isNaN(value) || value === null) return '<span class="na">N/A</span>';
                return `Bs. ${value.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            };

            const formatDollar = (value) => {
                 if (isNaN(value) || value === null) return 'N/A';
                return `$ ${value.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }
            
            const formatOriginalCost = (p) => {
                let baseCost, convertedCost = '';
                if (p.moneda === 'USD') {
                    baseCost = `$ ${p.costo.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    if (p.costoEnEur) {
                        convertedCost = ` / € ${p.costoEnEur.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    }
                } else { // EUR
                    baseCost = `€ ${p.costo.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                }
                return `${baseCost}<span class="costo-original-eur">${convertedCost}</span>`;
            };

            // --- FUNCIONES PRINCIPALES ---
            const agregarProducto = () => {
                const tasaBcv = parseFloat(tasaBcvInput.value);
                const tasaBinance = parseFloat(tasaBinanceInput.value);
                const tasaEuro = parseFloat(tasaEuroInput.value);
                const tasaUsdEur = parseFloat(tasaUsdEurInput.value);
                
                const nombre = productoNombreInput.value.trim();
                const costo = parseFloat(productoCostoInput.value);
                const moneda = productoMonedaSelect.value;

                if (!nombre || isNaN(costo) || costo <= 0) {
                    alert('Por favor, introduce un nombre y un costo válido para el producto.');
                    return;
                }

                let precioBcv = null, precioBinance = null, precioEuro = null, costoEnEur = null;

                if (moneda === 'USD') {
                    if (!isNaN(tasaBcv)) precioBcv = costo * tasaBcv;
                    if (!isNaN(tasaBinance)) precioBinance = costo * tasaBinance;
                    if (!isNaN(tasaUsdEur)) costoEnEur = costo * tasaUsdEur;
                    if (!isNaN(tasaEuro)) precioEuro = costo * tasaEuro; // Calcular también la tasa Euro para USD
                } else if (moneda === 'EUR') {
                    if (!isNaN(tasaEuro)) precioEuro = costo * tasaEuro;
                }

                const producto = {
                    id: Date.now(),
                    nombre, costo, moneda, costoEnEur,
                    precioBcv, precioBinance, precioEuro
                };
                productos.push(producto);
                
                renderTabla();
                productoNombreInput.value = '';
                productoCostoInput.value = '';
                productoNombreInput.focus();
            };

            const eliminarProducto = (id) => {
                productos = productos.filter(p => p.id !== id);
                renderTabla();
            };

            const calcularCotizacion = () => {
                if (productos.length === 0) {
                    alert('No hay productos en la lista para cotizar.');
                    return;
                }

                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                let totalUSD = 0, totalBsBinance = 0;

                productos.forEach(p => {
                    if (p.moneda === 'USD') {
                        totalUSD += p.costo;
                    }
                    if (p.precioBinance !== null && !isNaN(p.precioBinance)) {
                        totalBsBinance += p.precioBinance;
                    }
                });

                let resultHTML = '';
                if (paymentMethod === 'USD') {
                    resultHTML = `
                        <div class="resultado-item">
                            <h3>Total a Pagar (USD/USDT)</h3>
                            <p>${formatDollar(totalUSD)}</p>
                        </div>`;
                } else { // VES
                    resultHTML = `
                        <div class="resultado-item">
                            <h3>Total a Pagar (Bolívares)</h3>
                            <p class="total-bs">${formatBs(totalBsBinance)}</p>
                        </div>`;
                }
                cotizacionResultados.innerHTML = resultHTML;
            };

            const generarRecibo = () => {
                if (productos.length === 0) {
                    alert('No hay productos para generar un recibo.');
                    return false;
                }

                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
                let tableRows = '';
                let totalHTML = '';
                let headerHTML = '';

                if (paymentMethod === 'USD') {
                    headerHTML = 'Precio (USD)';
                    let totalReciboUsd = 0;

                    productos.forEach(p => {
                        if (p.moneda === 'USD') {
                            totalReciboUsd += p.costo;
                            tableRows += `
                                <tr>
                                    <td>${p.nombre}</td>
                                    <td class="text-right">${formatDollar(p.costo)}</td>
                                </tr>
                            `;
                        } else {
                            tableRows += `
                                <tr>
                                    <td>${p.nombre}</td>
                                    <td class="text-right">N/A (Costo en EUR)</td>
                                </tr>
                            `;
                        }
                    });
                    totalHTML = `<strong>${formatDollar(totalReciboUsd)}</strong>`;

                } else { // VES
                    headerHTML = 'Precio (Bs.)';
                    let totalReciboBs = 0;

                    productos.forEach(p => {
                        const precioBsBinance = p.precioBinance;
                        if (precioBsBinance !== null && !isNaN(precioBsBinance)) {
                            totalReciboBs += precioBsBinance;
                            tableRows += `
                                <tr>
                                    <td>${p.nombre}</td>
                                    <td class="text-right">${formatBs(precioBsBinance)}</td>
                                </tr>
                            `;
                        } else {
                            tableRows += `
                                <tr>
                                    <td>${p.nombre}</td>
                                    <td class="text-right">N/A</td>
                                </tr>
                            `;
                        }
                    });
                    totalHTML = `<strong>${formatBs(totalReciboBs)}</strong>`;
                }

                printableReceipt.innerHTML = `
                    <img src="imagenes/logo.png" alt="Logo" class="logo">
                    <h1>Recibo de Cotización</h1>
                    <table>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th class="text-right">${headerHTML}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                            <tr class="total-row">
                                <td><strong>Total a Pagar</strong></td>
                                <td class="text-right">${totalHTML}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
                return true;
            };

            // --- FUNCIÓN DE RENDERIZADO ---
            const renderTabla = () => {
                tablaBody.innerHTML = '';
                productos.forEach(p => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td data-label="Producto">${p.nombre}</td>
                        <td data-label="Costo Original">${formatOriginalCost(p)}</td>
                        <td data-label="Precio en Bs (Tasa BCV)">${formatBs(p.precioBcv)}</td>
                        <td data-label="Precio en Bs (Tasa Binance)">${formatBs(p.precioBinance)}</td>
                        <td data-label="Precio en Bs (Tasa Euro)">${formatBs(p.precioEuro)}</td>
                        <td data-label="Acción"><button class="btn btn-danger btn-eliminar" data-id="${p.id}">Eliminar</button></td>
                    `;
                    tablaBody.appendChild(newRow);
                });
            };

            // --- ASIGNAR EVENTOS ---
            btnAgregar.addEventListener('click', agregarProducto);
            btnCalcularCotizacion.addEventListener('click', calcularCotizacion);
            btnImprimir.addEventListener('click', () => {
                if (generarRecibo()) {
                    window.print();
                }
            });

            tablaBody.addEventListener('click', (e) => {
                if (e.target.classList.contains('btn-eliminar')) {
                    const id = parseInt(e.target.getAttribute('data-id'));
                    eliminarProducto(id);
                }
            });
            
            productoCostoInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    agregarProducto();
                }
            });

            // --- REFERENCIAS A ELEMENTOS DEL DOM PARA NUEVA FUNCIÓN ---
            const costoOriginalUsdRecompraInput = document.getElementById('costo-original-usd-recompra');
            const tasaP2pBinanceRecompraInput = document.getElementById('tasa-p2p-binance-recompra');
            const btnCalcularPrecioVentaBcv = document.getElementById('btn-calcular-precio-venta-bcv');
            const resultadoPrecioVentaBcvDiv = document.getElementById('resultado-precio-venta-bcv');
            const precioVentaBcvSugeridoP = document.getElementById('precio-venta-bcv-sugerido');
            const precioVentaBcvSugeridoUsdP = document.getElementById('precio-venta-bcv-sugerido-usd');

            // --- NUEVA FUNCIÓN ---
            const calcularPrecioVentaBcvParaRecompra = () => {
                const costoOriginalUsd = parseFloat(costoOriginalUsdRecompraInput.value);
                const tasaP2pBinance = parseFloat(tasaP2pBinanceRecompraInput.value);
                const tasaBcv = parseFloat(tasaBcvInput.value); // Obtener la tasa BCV del input existente

                if (isNaN(costoOriginalUsd) || costoOriginalUsd <= 0 ||
                    isNaN(tasaP2pBinance) || tasaP2pBinance <= 0 ||
                    isNaN(tasaBcv) || tasaBcv <= 0) {
                    alert('Por favor, introduce valores válidos para el costo original, la tasa P2P Binance y la tasa BCV.');
                    resultadoPrecioVentaBcvDiv.style.display = 'none';
                    return;
                }

                const precioVentaBcvSugerido = costoOriginalUsd * tasaP2pBinance;
                const usdEquivalente = precioVentaBcvSugerido / tasaBcv; // Calcular el equivalente en USD

                precioVentaBcvSugeridoP.textContent = formatBs(precioVentaBcvSugerido);
                precioVentaBcvSugeridoUsdP.textContent = `(${formatDollar(usdEquivalente)} al BCV)`;
                resultadoPrecioVentaBcvDiv.style.display = 'block';
            };

            // --- ASIGNAR EVENTOS PARA NUEVA FUNCIÓN ---
            btnCalcularPrecioVentaBcv.addEventListener('click', calcularPrecioVentaBcvParaRecompra);
        });
    </script>

</body>
</html>